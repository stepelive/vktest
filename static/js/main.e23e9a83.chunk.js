(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,a){"use strict";a.r(t);a(73),a(98);var n=a(0),r=a.n(n),s=a(39),i=a.n(s),o=a(21),l=a.n(o),c=a(67),u=a(68),d=a(70),f=a(69),v=a(71),h=a(22),m=a(1),g=(a(120),a(27)),p=a.n(g),w=a(20),S=a.n(w),y=a(28),E=a.n(y),A=Object(m.platform)();function k(e){var t=e.surveys,a=e.go_survey,n=t.map(function(e){return r.a.createElement(m.Cell,{onClick:a,"data-survey":e.title,expandable:!0,key:e.id,before:r.a.createElement(E.a,null)},e.title)});return r.a.createElement(m.List,null,n)}var P=function(e){var t=e.id,a=e.go,n=(e.user,e.onRefresh),s=e.surveys,i=e.refreshAwaiter,o=e.requestAwaiter,l=e.go_survey;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,{left:r.a.createElement(m.HeaderButton,{onClick:a,"data-to":"main"},A===m.IOS?r.a.createElement(p.a,null):r.a.createElement(S.a,null))},"\u0421\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u043f\u0440\u043e\u0441\u043e\u0432"),r.a.createElement(m.PullToRefresh,{onRefresh:n,isFetching:i},s&&r.a.createElement(m.Group,{title:"\u0412\u0430\u0448\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u043f\u0440\u043e\u0441\u044b"},r.a.createElement(k,{go_survey:l,requestAwaiter:o,surveys:s,go:a}))))},b=function(e){var t=e.id,a=e.ChangeSlide,n=e.SliderData;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,null,"\u041a\u0430\u043a \u044d\u0442\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442?"),r.a.createElement(m.Group,null,r.a.createElement(m.Gallery,{slideWidth:"100%",align:"center",style:{height:400},slideIndex:n.slideIndex,onChange:function(e){a(e)}},r.a.createElement("div",{style:{backgroundImage:'url("https://s3-us-west-1.amazonaws.com/powr/defaults/image-slider1.jpg")'}}),r.a.createElement("div",{style:{backgroundImage:'url("https://s3-us-west-1.amazonaws.com/powr/defaults/image-slider1.jpg")'}}),r.a.createElement("div",{style:{backgroundImage:'url("https://s3-us-west-1.amazonaws.com/powr/defaults/image-slider1.jpg")'}})),r.a.createElement(m.Div,null,r.a.createElement(m.Button,{size:"xl",onClick:function(){return a(n.slideIndex+1)}}," ",n.slideIndex+1==n.slides.length?"\u041f\u043e\u043d\u044f\u0442\u043d\u043e!":"\u0414\u0430\u043b\u044c\u0448\u0435"))))},C=a(18),q=a.n(C);function x(e){var t,a=e.question.avilableAnswers,n=e.sender,s=e.checker;return t="checkbox"==e.question.type?a.map(function(e){return r.a.createElement(m.Checkbox,{onChange:function(t){return function(e,t,a){a({answer:e.target.checked,id:t.id})}(t,e,n)},key:e.id.toString()},e.title)}):a.map(function(t){return r.a.createElement(m.Radio,{onChange:function(e){return s(t.id)},name:e.question.id,value:t.id,key:t.id.toString()},t.title)}),r.a.createElement(m.List,null,t)}var R=function(e){var t=e.id,a=e.go,n=e.sendAnswer,s=e.setAnswer,i=e.checkAnswer,o=(e.requestAwaiter,e.activeQuestion),l=e.activeSurvey;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,{left:r.a.createElement(m.HeaderButton,{onClick:a,"data-to":"surveys"},r.a.createElement(q.a,null))},l.title),r.a.createElement(m.Group,null,r.a.createElement(m.Div,null,o.title),o.imageSrc&&r.a.createElement("img",{src:o.imageSrc,alt:"da",style:{width:"100%"}}),r.a.createElement(x,{sender:s,checker:i,question:o}),r.a.createElement(m.Div,null,r.a.createElement(m.Button,{size:"xl",onClick:n,level:"primary"},"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441"))))};function O(e){var t,a=e.question.avilableAnswers,n=e.sender,s=e.stringAnswer,i=e.checker;return t="checkbox"==e.question.type?a.map(function(e){return r.a.createElement(m.Checkbox,{onChange:function(t){return function(e,t,a){a({answer:e.target.checked,id:t.id})}(t,e,n)},key:e.id.toString()},e.title)}):"radio"==e.question.type?a.map(function(t){return r.a.createElement(m.Radio,{onChange:function(e){return i(t.id)},name:e.question.id,value:t.id,key:t.id.toString()},t.title)}):r.a.createElement(m.Input,{type:"text",onChange:function(e){return function(e,t){t(e)}(e,s)},placeholder:"\u041a\u0440\u0430\u0442\u043a\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0412\u0430\u0448\u0435\u0439 \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u0438"}),r.a.createElement(m.List,null,t)}var Q=function(e){var t=e.id,a=e.go,n=e.sendAnswer,s=e.stringAnswer,i=e.setAnswer,o=e.checkAnswer,l=(e.requestAwaiter,e.activeQuestion);return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,{left:r.a.createElement(m.HeaderButton,{onClick:a,"data-to":"profile"},r.a.createElement(q.a,null))},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c\u043d\u044b\u0435 \u043e\u043f\u0440\u043e\u0441\u044b"),r.a.createElement(m.Group,null,r.a.createElement(m.Div,null,l.title),l.imageSrc&&r.a.createElement("img",{src:l.imageSrc,alt:"da",style:{width:"100%"}}),r.a.createElement(O,{stringAnswer:s,sender:i,checker:o,question:l}),r.a.createElement(m.Div,null,r.a.createElement(m.Button,{size:"xl",onClick:n,level:"primary"},"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441"))))},D=function(e){var t=e.id,a=e.go,n=(e.user,e.onRefresh),s=e.surveys,i=(e.agreement,e.userSurveys),o=e.refreshAwaiter;e.requestAwaiter,e.go_survey;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,null,"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"),r.a.createElement(m.PullToRefresh,{onRefresh:n,isFetching:o},r.a.createElement(m.Group,null,r.a.createElement(m.List,null,i&&r.a.createElement(m.Cell,{onClick:a,"data-to":"profile",indicator:i.length},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),s&&r.a.createElement(m.Cell,{onClick:a,"data-to":"surveys",indicator:s.length},"\u041e\u043f\u0440\u043e\u0441\u044b"),r.a.createElement(m.Cell,{onClick:a,"data-to":"slider"},"\u041a\u0430\u043a \u044d\u0442\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442?"),r.a.createElement(m.Cell,{onClick:a,"data-to":"debug"},"Debug")))))},I=function(e){var t=e.id,a=e.Accept,n=e.Agreement;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,null,"\u0421\u043e\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435"),n&&r.a.createElement(m.Group,{title:n.title},r.a.createElement(m.Div,null,n.body),r.a.createElement(m.Div,null,r.a.createElement(m.Button,{size:"xl",onClick:function(){return a()}},"\u042f \u0441\u043e\u0433\u043b\u0430\u0441\u0435\u043d"))))},H=function(e){var t=e.info,a=e.go,n=e.id;return r.a.createElement(m.Panel,{id:n},r.a.createElement(m.PanelHeader,{left:r.a.createElement(m.HeaderButton,{onClick:a,"data-to":"main"},r.a.createElement(q.a,null))},"Debug"),r.a.createElement(m.Group,{title:"Debug"},r.a.createElement(m.Div,null,t)))},j=Object(m.platform)();function B(e){var t=e.userSurveys,a=e.go_survey,n=t.map(function(e){return r.a.createElement(m.Cell,{onClick:a,"data-id":e.id,expandable:!0,key:e.id,before:r.a.createElement(E.a,null)},e.title)});return r.a.createElement(m.List,null,n)}var _=function(e){var t=e.id,a=e.go,n=e.user,s=e.onRefresh,i=e.ballance,o=e.go_userSurvey,l=e.userSurveys,c=e.refreshAwaiter;return r.a.createElement(m.Panel,{id:t},r.a.createElement(m.PanelHeader,{left:r.a.createElement(m.HeaderButton,{onClick:a,"data-to":"main"},j===m.IOS?r.a.createElement(p.a,null):r.a.createElement(S.a,null))},"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f"),n&&r.a.createElement(m.Cell,{photo:n.photo_max_orig,description:"\u0412\u0430\u0448 \u0431\u0430\u043b\u0430\u043d\u0441: ".concat(i," \u0440"),before:r.a.createElement(m.Avatar,{src:n.photo_max_orig,size:80}),size:"l"},n.first_name," ",n.last_name),r.a.createElement(m.PullToRefresh,{onRefresh:s,isFetching:c},l&&r.a.createElement(B,{userSurveys:l,go_survey:o})))},G=a(9),T=a.n(G),J=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e))).showAgreement=function(){a.setState({activePanel:"agreement"})},a.survey=function(e){var t=a.state.dataSurveys.find(function(t){return t.title==e.currentTarget.dataset.survey}),n=t.questions[0];console.log(t),a.setState({activePanel:"survey",activeQuestion:n,activeSurvey:t})},a.showMessage=function(e){},a.setAnswer=function(e){var t=a.state.answers;if(e.answer)e.data=Date.now(),t.push(e.id);else{var n=t.find(function(t){return t==e.id}),r=t.indexOf(n);-1==r?console.log("not has in index"):t.splice(r,1)}a.setState({answers:t})},a.setStringAnswer=function(e){a.setState({stringAnswer:e.target.value})},a.checkAnswer=function(e){e.data=Date.now();var t=[];t.push(e),a.setState({answers:t})},a.sendAnswers=function(){a.setState({requestAwaiter:r.a.createElement(m.ScreenSpinner,null)});var e=a.state.answers.length,t=Object(h.a)(Object(h.a)(a)),n=a.state.user.id;a.state.answers.forEach(function(r){var s={date:Date.now(),UserId:n,AnswerId:r};T.a.post("".concat(a.state.host,"/Home/SetAnswer"),s,{headers:{"Content-Type":"application/json"}}).then(function(n){e--;var r=t.state.activeQuestion.price;t.setState({userBallance:t.state.userBallance+r}),0==e&&a.nextQuestion()}).catch(function(e){a.afterRequest(),a.setState({additional:"Exception: ".concat(JSON.stringify(e))})})})},a.checkAgreement=function(){try{T.a.post("".concat(a.state.host,"/Home/GetUserAgreement"),a.state.user,{headers:{"Content-Type":"application/json"}}).then(function(e){e.data.agreement?(a.setState({additional:"Resp: ".concat(JSON.stringify(e)),agreement:e.data.agreement,requestAwaiter:null,refreshAwaiter:!1}),a.showAgreement()):0==e.data&&(a.setState({additional:"Resp: ".concat(JSON.stringify(e))}),a.refreshSurveys())}).catch(function(e){a.setState({additional:"Resp: ".concat(JSON.stringify(e)),requestAwaiter:null,refreshAwaiter:!1})})}catch(e){a.setState({additional:"Resp: ".concat(JSON.stringify(e)),requestAwaiter:null,refreshAwaiter:!1})}},a.showErrorMessage=function(e){a.setState({additional:e,activePanel:"debug"})},a.confirmAgreement=function(){T.a.post("".concat(a.state.host,"/Home/SubmitUserAgreement"),a.state.user,{headers:{"Content-Type":" application/json"}}).then(function(e){a.setState({activePanel:"main"}),a.setState({agreement:null}),a.refreshSurveys()}).catch(function(e){a.setState({additional:JSON.stringify(e),activePanel:"main"})})},a.showInstruction=function(){},a.ChangeSlide=function(e){var t=a.state.SliderData;e==t.slides.length?(t.slideIndex=0,a.setState({activePanel:"main",SliderData:t})):(t.slideIndex=e,a.setState({SliderData:t}))},a.refreshSurveys=function(){a.setState({refreshAwaiter:!0}),T.a.post("".concat(a.state.host,"/Home/GetSurveys"),a.state.user,{headers:{"Content-Type":"application/json"}}).then(function(e){a.afterRequest(),a.setState({dataSurveys:e.data})}).catch(function(e){a.afterRequest(),a.setState({additional:"Exception: ".concat(JSON.stringify(e))})}),T.a.post("".concat(a.state.host,"/Home/GetProfileSurveys"),a.state.user,{headers:{"Content-Type":"application/json"}}).then(function(e){a.afterRequest(),a.setState({userSurveys:e.data.questions})}).catch(function(e){a.afterRequest(),a.setState({additional:"Exception: ".concat(JSON.stringify(e))})}),T.a.post("".concat(a.state.host,"/Home/GetBallance"),a.state.user,{headers:{"Content-Type":"application/json"}}).then(function(e){a.afterRequest(),a.setState({userBallance:e.data})}).catch(function(e){a.afterRequest(),a.setState({additional:"Exception: ".concat(JSON.stringify(e))})})},a.nextQuestion=function(){if(void 0!=a.state.stringAnswer){var e=a.state.user.id,t={date:Date.now(),UserId:e,EmptyAnswer:a.state.stringAnswer};T.a.post("".concat(a.state.host,"/Home/SetAnswer"),t,{headers:{"Content-Type":"application/json"}}).then(function(e){})}var n=a.state.activeSurvey.questions.indexOf(a.state.activeQuestion),r=a.state.activeSurvey.questions[n+1],s=a.state.activeSurvey;if(s.questions.splice(n,1),void 0==r){var i=a.state.dataSurveys;i.splice(i.indexOf(a.state.activeSurvey),1),a.setState({activePanel:"surveys",dataSurveys:i,answers:[],stringAnswer:void 0,requestAwaiter:!1})}else a.setState({activeSurvey:s,activeQuestion:r,answers:[],stringAnswer:void 0,requestAwaiter:!1})},a.userSurvey=function(e){var t=a.state.userSurveys.find(function(t){return t.id==e.currentTarget.dataset.id});a.setState({activePanel:"profileQuestions",activeProfileQuestion:t})},a.checkProfileAnswer=function(e){var t=[];t.push(e),a.setState({profileAnswers:t})},a.setProfileAnswer=function(e){var t=a.state.profileAnswers;if(e.answer)t.push(e.id);else{var n=t.find(function(t){return t==e.id}),r=t.indexOf(n);-1==r?console.log("not has in index"):t.splice(r,1)}a.setState({profileAnswers:t})},a.sendProfileAnswers=function(){a.setState({requestAwaiter:r.a.createElement(m.ScreenSpinner,null)});var e=a.state.profileAnswers.length,t=a.state.user.id;a.state.profileAnswers.forEach(function(n){var r={userId:t,answerId:n,date:Date.now()};T.a.post("".concat(a.state.host,"/Home/SetProfileAnswer"),r,{headers:{"Content-Type":"application/json"}}).then(function(t){0==--e&&a.nextProfileQuestion()}).catch(function(e){a.afterRequest(),a.setState({activePanel:"debug",additional:"Exception: ".concat(JSON.stringify(e))})})})},a.nextProfileQuestion=function(){var e=a.state.userSurveys.indexOf(a.state.activeProfileQuestion),t=a.state.userSurveys;t.splice(e,1);var n=a.state.userSurveys[e];void 0==n?a.setState({activePanel:"profile",userSurveys:t,profileAnswers:[],requestAwaiter:!1}):a.setState({activeProfileQuestion:n,profileAnswers:[],requestAwaiter:!1})},a.afterRequest=function(){a.setState({requestAwaiter:null,refreshAwaiter:!1})},a.beforeRequest=function(){a.setState({requestAwaiter:r.a.createElement(m.ScreenSpinner,null),refreshAwaiter:!0})},a.go=function(e){a.setState({activePanel:e.currentTarget.dataset.to})},a.state={activePanel:"main",history:["main"],user:void 0,dataSurveys:void 0,activeSurvey:void 0,activeQuestion:void 0,additional:void 0,userSurveys:[{da:"net"}],answers:[],stringAnswer:void 0,requestAwaiter:r.a.createElement(m.ScreenSpinner,null),refreshAwaiter:!1,activeProfileQuestion:void 0,profileAnswers:[],userBallance:0,host:"https://web20190521031103.azurewebsites.net/",messageBox:"",agreement:"",SliderData:{slideIndex:0,slides:["","",""]}},a}return Object(v.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;l.a.subscribe(function(t){switch(t.detail.type){case"VKWebAppGetUserInfoResult":e.setState({user:t.detail.data}),e.checkAgreement();break;default:console.log(t.detail.type)}}),l.a.send("VKWebAppGetUserInfo",{})}},{key:"render",value:function(){return r.a.createElement(m.View,{popout:this.state.requestAwaiter,activePanel:this.state.activePanel},r.a.createElement(D,{id:"main",go:this.go,onRefresh:this.refreshSurveys,refreshAwaiter:this.state.refreshAwaiter,surveys:this.state.dataSurveys,userSurveys:this.state.userSurveys,user:this.state.user}),r.a.createElement(I,{id:"agreement",Agreement:this.state.agreement,Accept:this.confirmAgreement}),r.a.createElement(_,{id:"profile",ballance:this.state.userBallance,go:this.go,go_userSurvey:this.userSurvey,user:this.state.user,userSurveys:this.state.userSurveys}),r.a.createElement(P,{id:"surveys",go:this.go,onRefresh:this.refreshSurveys,refreshAwaiter:this.state.refreshAwaiter,surveys:this.state.dataSurveys,user:this.state.user,go_survey:this.survey}),r.a.createElement(R,{id:"survey",go:this.go,checkAnswer:this.checkAnswer,nextQuestion:this.nextQuestion,setAnswer:this.setAnswer,sendAnswer:this.sendAnswers,activeQuestion:this.state.activeQuestion,activeSurvey:this.state.activeSurvey}),r.a.createElement(Q,{stringAnswer:this.setStringAnswer,id:"profileQuestions",go:this.go,checkAnswer:this.checkProfileAnswer,nextQuestion:this.nextProfileQuestion,setAnswer:this.setProfileAnswer,sendAnswer:this.sendProfileAnswers,activeQuestion:this.state.activeProfileQuestion}),r.a.createElement(H,{id:"debug",go:this.go,info:this.state.additional}),r.a.createElement(b,{id:"slider",ChangeSlide:this.ChangeSlide,SliderData:this.state.SliderData}))}}]),t}(r.a.Component);l.a.send("VKWebAppInit",{}),i.a.render(r.a.createElement(J,null),document.getElementById("root"))},72:function(e,t,a){e.exports=a(139)}},[[72,1,2]]]);
//# sourceMappingURL=main.e23e9a83.chunk.js.map