(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(e,t,n){e.exports=n(206)},197:function(e,t,n){},206:function(e,t,n){"use strict";n.r(t);n(147),n(172);var a=n(0),r=n.n(a),s=n(22),i=n.n(s),o=n(36),l=n.n(o),c=n(30),u=n(31),d=n(33),h=n(32),f=n(34),g=n(7),v=n(87),m=n.n(v),b=n(56),p=n.n(b),E=n(88),I=n.n(E),y=n(89),S=n.n(y),k=n(19),O=n.n(k),w=(n(197),n(4)),j=(n(54),n(37)),C="https://www.big-ben.ru/sites/default/files/reviews/mo.png",M="https://lh3.googleusercontent.com/XtyURW0mKNnKu_6TzQ5_WpuKF4A7M1oFV6p828eVEWIvTZPtZz2gq5sNM78jpNPMMRmZ",A={backgroundColor:"rgba(248, 247, 216, 0.1)",position:"absolute",top:0,left:0,width:"100%",height:"100%"},P={position:"absolute",backgroundColor:"#f8f8f8",backgroundPosition:"center",backgroundSize:"90%",boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"},U={backgroundSize:"contain",backgroundRepeat:"no-repeat",overflow:"hidden",backgroundPosition:"center",margin:0,padding:0},x={display:"flex",flexWrap:"wrap",justifyContent:"space-around",alignContent:"right"},D=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={id:e.id,userInterests:e.userInterests,debugServerInfo:e.debugServerInfo,addPair:e.addPair,user:e.user,users:[],rot:0,loading:!1,moveBack:.1,shiftX:0,shiftY:0,debugInfo:"",limitOffset:3,userPicBackgroundColor:"",sizeX:390,sizeY:900,halfX:39,minchange:2,popout:null},n.startX=0,n.startY=0,n.renderInterests=n.renderInterests.bind(Object(g.a)(Object(g.a)(n))),n.onMove=n.onMove.bind(Object(g.a)(Object(g.a)(n))),n.refreshUsers=n.refreshUsers.bind(Object(g.a)(Object(g.a)(n))),n.onEnd=n.onEnd.bind(Object(g.a)(Object(g.a)(n))),n.getUsers=n.getUsers.bind(Object(g.a)(Object(g.a)(n))),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.setState({sizeX:window.innerWidth,sizeY:window.innerHeight}),this.getUsers()}},{key:"onMove",value:function(e){var t=this.startX+e.shiftX,n=t/this.state.halfX;this.setState({rot:n,moveBack:.1,shiftX:t})}},{key:"getUsers",value:function(e){var t=this;t.setState({popout:r.a.createElement(w.q,null)}),O.a.get("https://salert.info/users/GetUsersTest/".concat(this.state.user.id)).then(function(e){t.setState({}),t.setState({popout:null,debugInfo:"done-".concat(JSON.stringify(e.data)),users:e.data})}).catch(function(e){t.setState({popout:null,debugInfo:"\u041e\u0448\u0438\u0431\u043a\u0430 "+JSON.stringify(e)})})}},{key:"onEnd",value:function(e){var t=this,n=this.state.debugInfo,a=this.state.users;if(Math.abs(this.state.rot)<this.state.limitOffset)this.setState({rot:0,moveBack:.5,shiftX:0,shiftY:0});else if(this.agree||this.disAgree){this.agree?n+="+".concat(this.state.users[0].first_name):n+="-".concat(this.state.users[0].first_name);var r={currentUserId:this.state.user.id,choicedUserId:a[0].id,choiced:this.agree},s=this,i=s.state.rot>0?15:-15;this.setState({userPicBackgroundColor:"",rot:i,debugInfo:n,moveBack:.1,shiftX:0,shiftY:0}),O.a.post("https://salert.info/user/SetChoice",r).then(function(e){if(!0===e.data){var t=a[0];s.state.addPair(t)}a.splice(0,1),s.setState({rot:0,users:a,moveBack:0}),0===a.length&&s.getUsers()}).catch(function(e){s.showAlert("\u041e\u0448\u0438\u0431\u043a\u0430",JSON.stringify(e),"")})}else{i=this.state.rot>0?15:-15;setTimeout(function(){a=a.splice(0,1),t.setState({rot:0,users:a,moveBack:0})},100)}}},{key:"refreshUsers",value:function(e){this.getUsers()}},{key:"getCircleRef",value:function(e){this.circleRef=e}},{key:"showAlert",value:function(e,t,n){var a=this;this.setState({popout:r.a.createElement(w.a,{actions:[{title:n,autoclose:!0}],onClose:function(e){a.setState({popout:null})}},r.a.createElement("h2",null,e),r.a.createElement("p",null,t))})}},{key:"getSexPreference",value:function(e){var t=e.ageFromPreference?" \u043e\u0442 ".concat(e.ageFromPreference):"";return t+=e.ageToPreference?" \u0434\u043e ".concat(e.ageToPreference):"",0==e.sexPreference?"\u0445\u043e\u0442\u044c \u043a\u043e\u0433\u043e ".concat(t):1==e.sexPreference?"\u0436\u0435\u043d\u0449\u0438\u0443 ".concat(t):"\u043c\u0443\u0436\u0447\u0438\u043d\u0443 ".concat(t)}},{key:"getSex",value:function(e){return 0==e.sex?"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d":1==e.sex?"\u0436\u0435\u043d\u0441\u043a\u0438\u0439":"\u043c\u0443\u0436\u0441\u043a\u043e\u0439"}},{key:"getReason",value:function(e){var t;if(void 0==e.searchReason)return"\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u043e \u0432\u043e\u043e\u0431\u0449\u0435 \u0447\u0435\u0433\u043e";switch(e.searchReason){case 0:t="\u043e\u0431\u0449\u0435\u043d\u0438\u044f";break;case 1:t="\u0434\u0440\u0443\u0436\u0431\u044b";break;case 2:t="\u043b\u044e\u0431\u0432\u0438";break;case 3:t="\u0441\u0435\u043a\u0441\u0430";break;default:t="\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u043e \u0432\u043e\u043e\u0431\u0449\u0435 \u0447\u0435\u0433\u043e"}return t}},{key:"birthDateToAge",value:function(e){e=new Date(e);var t=new Date,n=t.getFullYear()-e.getFullYear();return t.setFullYear(1972)<e.setFullYear(1972)?n-1:n}},{key:"getYo",value:function(e){var t=new Date(e.bdate+"Z"),n=this.birthDateToAge(t);return"".concat(t.getFullYear(),", ").concat(n," \u043b\u0435\u0442")}},{key:"renderInterests",value:function(e){var t;t=[];var n=this.state.userInterests;return void 0!=e?e.forEach(function(e){var a=n.find(function(t){return t.id===e.id});t.push(r.a.createElement(w.c,{level:a?"primary":"secondary",component:"span",style:{marginTop:5,marginRight:3}},e.title))}):t=r.a.createElement("b",null,"\u041d\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432"),r.a.createElement(w.e,{style:Object(j.a)({lineHeight:"2.5"},x)}," ",t)}},{key:"render",value:function(){var e=this.state,t=e.id,n=e.popout,a=e.users,s=e.sizeX,i=e.sizeY,o=e.moveBack,l=e.debugInfo,c=e.userPicBackgroundColor,u=e.rot,d=a[0];return r.a.createElement(w.u,{id:t,activePanel:t,popout:n},r.a.createElement(w.o,{id:t,style:{overflow:"hidden"}},r.a.createElement(w.p,null,u," New"),r.a.createElement(w.i,null,0!==a.length&&void 0!==a[0]&&r.a.createElement(w.t,{onMove:this.onMove,onEnd:this.onEnd,style:Object(j.a)({},P,{transformOrigin:"center ".concat(3*i,"px"),width:s,height:i,transition:"transform ".concat(o,"s ease-out"),transform:"rotate(".concat(u,"deg)")})},r.a.createElement(w.e,{style:{height:"100%",padding:0}},r.a.createElement("div",{style:Object(j.a)({},A,{backgroundColor:c})}),r.a.createElement(w.e,null,r.a.createElement("h1",{style:{textAlign:"center"}},r.a.createElement("strong",null,d.first_name," ",d.last_name)),r.a.createElement("h5",null,this.getYo(d)),r.a.createElement("h5",null,"\u041f\u043e\u043b ",this.getSex(d),", \u0438\u0449\u0435\u0442 ",this.getSexPreference(d)," \u0434\u043b\u044f ",this.getReason(d))),r.a.createElement(w.e,{style:Object(j.a)({},U,{width:s,height:i/4,backgroundImage:"url(".concat(1==d.sex?C:M,")")})}),this.renderInterests(d.interests))),0===a.length&&r.a.createElement(w.i,null,r.a.createElement("h1",null,"\u041f\u043e\u043a\u0430 \u0447\u0442\u043e \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442\u0443 :( \u041c\u043e\u0436\u0435\u0448\u044c \u043f\u043e\u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c, \u043d\u043e \u0441\u0435\u0439\u0447\u0430\u0441 \u044d\u0442\u043e \u043d\u0435 \u043e\u0441\u043e\u0431\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0431\u0440\u043e "),r.a.createElement(w.c,{onClick:this.refreshUsers},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c"),r.a.createElement(w.e,null,l)))))}},{key:"agree",get:function(){var e=this.state,t=e.shiftX,n=e.limitOffset;return Math.abs(t)>n&&t>0}},{key:"disAgree",get:function(){var e=this.state,t=e.shiftX,n=e.limitOffset;return Math.abs(t)>n&&t<0}}]),t}(r.a.Component),N=n(58),R=n.n(N),_=n(44),F=n.n(_),T=n(42),X=n(99),J=n.n(X),Y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={userInterests:e.userInterests,activeModal:null,openInterestsModal:e.openInterestsModal,id:e.id,user:e.user,interests:[],debugInfo:"\u0422\u0443\u0442 \u0434\u0435\u0431\u0430\u0433",deNorm:"\u041d\u0443 \u0442\u0435\u0441\u0442\u044b",popout:null},n.renderUserInterests=n.renderUserInterests.bind(Object(g.a)(Object(g.a)(n))),n.setActiveModal=n.setActiveModal.bind(Object(g.a)(Object(g.a)(n))),n.getInterests=n.getInterests.bind(Object(g.a)(Object(g.a)(n))),n.renderModalInterests=n.renderModalInterests.bind(Object(g.a)(Object(g.a)(n))),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initInterests()}},{key:"renderUserInterests",value:function(){var e=this,t=[];return void 0!==this.state.userInterests&&this.state.userInterests.length>0?this.state.userInterests.forEach(function(n){t.push(r.a.createElement(w.c,{style:{marginRight:5},onClick:function(){return e.deleteInterestFromCurrentUser(n.id)},after:r.a.createElement(F.a,null)},n.title))}):t=r.a.createElement("b",null,"\u041d\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432"),r.a.createElement(w.e,{style:{padding:10,lineHeight:"2.5"}}," ",t)}},{key:"showAlert",value:function(e,t,n){var a=this;this.setState({popout:r.a.createElement(w.a,{actions:[{title:n,autoclose:!0}],onClose:function(e){a.setState({popout:null})}},r.a.createElement("h2",null,e),r.a.createElement("p",null,t))})}},{key:"showAddInterestsModal",value:function(){this.state.userInterests.length<10?this.setActiveModal("user_interests"):this.showAlert("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u043e\u043b\u0435\u0435 ".concat(10," \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432"),"\u0417\u0430\u043a\u0440\u044b\u0442\u044c")}},{key:"setActiveModal",value:function(e){this.setState({activeModal:e})}},{key:"addInterestToCurrentUser",value:function(e){if(this.state.userInterests.length<10){var t=this;this.setState({popout:r.a.createElement(w.q,null)});var n={userId:this.state.user.id,interestId:e};O.a.post("https://salert.info/interests/AddInterest",n).then(function(e){t.setState({popout:null,debugInfo:"done-".concat(JSON.stringify(e.data)),userInterests:e.data})}).catch(function(e){t.setState({popout:null,debugInfo:"\u041e\u0448\u0438\u0431\u043a\u0430 "+JSON.stringify(e)})})}else this.setActiveModal(null),this.showAlert("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u043e\u043b\u0435\u0435 10 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432","\u0417\u0430\u043a\u0440\u044b\u0442\u044c")}},{key:"deleteInterestFromCurrentUser",value:function(e){var t=this,n={userId:this.state.user.id,interestId:e};this.setState({popout:r.a.createElement(w.q,null)}),O.a.post("https://salert.info/interests/DeleteInterest",n).then(function(e){t.setState({popout:null,debugInfo:"done-".concat(JSON.stringify(e.data)),userInterests:e.data})}).catch(function(e){t.setState({popout:null,debugInfo:"\u041e\u0448\u0438\u0431\u043a\u0430 "+JSON.stringify(e)})})}},{key:"renderModalInterests",value:function(){var e=this;if(null==this.state.interests)return"\u041d\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432";var t=[];return this.state.interests.forEach(function(n){e.state.userInterests&&void 0!==e.state.userInterests.find(function(e){return e.id===n.id})?t.push(r.a.createElement(w.c,{style:{marginRight:5},onClick:function(){return e.deleteInterestFromCurrentUser(n.id)},after:r.a.createElement(F.a,null)},n.title)):t.push(r.a.createElement(w.c,{level:"outline",style:{marginRight:5},onClick:function(){return e.addInterestToCurrentUser(n.id)},after:r.a.createElement(R.a,null)},n.title))}),r.a.createElement(w.e,{style:{padding:15,lineHeight:"2.5"}},t)}},{key:"initInterests",value:function(e){var t=this;O.a.get("https://salert.info/interests/GetTopInterests").then(function(e){t.setState({debugInfo:JSON.stringify(e.data),interests:e.data})}).catch(function(e){t.setState({debugInfo:"\u041e\u0448\u0438\u0431\u043a\u0430 "+JSON.stringify(e)})})}},{key:"getInterests",value:function(e){if(e.target.value.length<2)this.setState({interests:null});else{var t=this;O.a.get("https://salert.info/interests/SearchFromQuery?str=".concat(e.target.value)).then(function(e){t.setState({debugInfo:JSON.stringify(e.data),interests:e.data})}).catch(function(e){t.setState({debugInfo:"\u041e\u0448\u0438\u0431\u043a\u0430 "+JSON.stringify(e)})})}}},{key:"render",value:function(){var e=this,t=this.state,n=t.id,a=t.user,s=t.popout,i=t.activeModal,o=(t.debugInfo,t.userInterests),l=(t.interests,t.deNorm,r.a.createElement(w.n,{activeModal:i},r.a.createElement(w.l,{popout:s,id:"user_interests",settlingHeight:100,header:r.a.createElement(w.m,{left:T.IS_PLATFORM_ANDROID&&r.a.createElement(w.j,{onClick:function(){e.setActiveModal(null)}},r.a.createElement(F.a,null)),right:r.a.createElement(w.j,{onClick:function(){e.setActiveModal(null)}},T.IS_PLATFORM_IOS?"\u0413\u043e\u0442\u043e\u0432\u043e":r.a.createElement(J.a,null))},"\u0424\u0438\u043b\u044c\u0442\u0440\u044b")},r.a.createElement(this.renderModalInterests,null),r.a.createElement(w.g,null,r.a.createElement(w.h,{top:"\u041f\u043e\u0438\u0441\u043a",onInput:function(t){e.getInterests(t)}},r.a.createElement(w.k,{placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0432\u0432\u043e\u0434\u0438\u0442\u044c"}))))));return r.a.createElement(w.u,{id:n,popout:s,modal:l,activePanel:n},r.a.createElement(w.o,{id:n},r.a.createElement(w.p,null,"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"),a&&r.a.createElement(w.i,{title:"\u041e\u0431\u0449\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"},r.a.createElement(w.d,{size:"m",before:r.a.createElement(w.b,{src:a.photo_max_orig,size:80})},a.first_name," ",a.last_name)),a&&r.a.createElement(w.i,{title:"\u0418\u043d\u0442\u0435\u0440\u0435\u0441\u044b (".concat(o?o.length:0,"\\").concat(10,")")},o&&r.a.createElement(this.renderUserInterests,null),r.a.createElement(w.d,null,r.a.createElement(w.c,{before:r.a.createElement(R.a,null),level:"secondary",onClick:function(){e.showAddInterestsModal()},size:"l"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u044b")))))}}]),t}(r.a.Component),z=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={debug:!0,activeStory:{view:"loader",panel:"loader"},activeModal:null,pairs:[],history:[{view:"loader",panel:"loader"}],user:void 0,userInterests:[],debugServerInfo:"default"},n.onStoryChange=n.onStoryChange.bind(Object(g.a)(Object(g.a)(n))),n.renderDebug=n.renderDebug.bind(Object(g.a)(Object(g.a)(n))),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;l.a.subscribe(function(t){switch(t.detail.type){case"VKWebAppGetUserInfoResult":e.setState({user:t.detail.data});var n=e;O.a.post("https://salert.info/user/GetUserData",t.detail.data).then(function(e){O.a.get("https://salert.info/interests/GetInterests/".concat(t.detail.data.id)).then(function(e){n.renderDebug(e.data,!1)}).catch(function(e){n.renderDebug(e,!0)})}).catch(function(e){n.renderDebug(e,!0)});break;default:console.log(t.detail.type)}}),l.a.send("VKWebAppGetUserInfo",{})}},{key:"renderDebug",value:function(e,t){var n=t?"\u041e\u0448\u0438\u0431\u043a\u0430 ":"\u041d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 ";t||this.setState({userInterests:e}),this.setState({debugServerInfo:n+JSON.stringify(e),activeStory:{view:"info",panel:"info"}})}},{key:"onStoryChange",value:function(e){var t=this.state.activeStory;t.view=e.currentTarget.dataset.view,this.setState({activeStory:t})}},{key:"addPair",value:function(e){var t=this.state.pairs;t.push(e),this.setState({pairs:t})}},{key:"render",value:function(){var e=this.state,t=e.user,n=e.pairs,a=e.userInterests;return r.a.createElement(w.f,{activeStory:this.state.activeStory.view,tabbar:r.a.createElement(w.r,null,r.a.createElement(w.s,{onClick:this.onStoryChange,selected:"info"===this.state.activeStory.view,"data-view":"info",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},r.a.createElement(m.a,null)),r.a.createElement(w.s,{onClick:this.onStoryChange,selected:"cards"===this.state.activeStory.view,"data-view":"cards",text:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0438"},r.a.createElement(S.a,null)),r.a.createElement(w.s,{onClick:this.onStoryChange,selected:"base"===this.state.activeStory.view,"data-view":"base",label:n.length.toString(),text:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"},r.a.createElement(I.a,null)),r.a.createElement(w.s,{onClick:this.onStoryChange,selected:"settings"===this.state.activeStory.view,"data-view":"settings",text:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"},r.a.createElement(p.a,null)),r.a.createElement(w.s,{onClick:this.onStoryChange,selected:"debug"===this.state.activeStory.view,"data-view":"debug",text:"\u0414\u0435\u0431\u0430\u0433"},r.a.createElement(p.a,null)))},r.a.createElement(w.u,{id:"loader",popout:r.a.createElement(w.q,null),activePanel:"loader"},r.a.createElement(w.o,{id:"loader"},r.a.createElement(w.p,null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."))),r.a.createElement(Y,{userInterests:a,id:"info",user:t}),r.a.createElement(D,{id:"cards",addPair:this.addPair,user:t,userInterests:a,debugServerInfo:this.state.debugServerInfo}),r.a.createElement(w.u,{id:"debug",activePanel:"debug"},r.a.createElement(w.o,{id:"debug"},r.a.createElement(w.p,null,"Debug"),r.a.createElement(w.e,null,this.state.debugServerInfo))))}}]),t}(r.a.Component);l.a.send("VKWebAppInit",{}),i.a.render(r.a.createElement(z,null),document.getElementById("root"))}},[[146,1,2]]]);
//# sourceMappingURL=main.69e3591b.chunk.js.map